{"paragraphs":[{"title":"Exibir databases","text":"%pyspark\nspark.sql(\"show databases\").show()\n","user":"anonymous","dateUpdated":"2020-03-07T17:15:34+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------------+\n|      databaseName|\n+------------------+\n|  db_ecommerce_dev|\n|  db_ecommerce_raw|\n|           default|\n|sessions_ecommerce|\n+------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1583601193945_243239835","id":"20181208-134230_1861185261","dateCreated":"2020-03-07T17:13:13+0000","dateStarted":"2020-03-07T17:15:34+0000","dateFinished":"2020-03-07T17:16:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2673"},{"title":"Acessar database e exibir tabelas","text":"%pyspark\nspark.sql(\"use sessions_ecommerce\")\nspark.sql(\"show tables\").show()","user":"anonymous","dateUpdated":"2020-03-07T17:16:19+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------------+----------+-----------+\n|          database| tableName|isTemporary|\n+------------------+----------+-----------+\n|sessions_ecommerce|aggregated|      false|\n|sessions_ecommerce|   rawdata|      false|\n+------------------+----------+-----------+\n\n"}]},"apps":[],"jobName":"paragraph_1583601193950_121154056","id":"20181208-134259_1561086742","dateCreated":"2020-03-07T17:13:13+0000","dateStarted":"2020-03-07T17:16:19+0000","dateFinished":"2020-03-07T17:16:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2674"},{"title":"selecionar tabela rawdata","text":"%pyspark\ndf = spark.sql(\"select * from sessions_ecommerce.rawdata\")\ndf.show(10)","user":"anonymous","dateUpdated":"2020-03-07T17:17:42+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+------------------+-------------------+----------+------------+--------------------+-----------+-----------+-----------+-----------+\n|custid|       trafficfrom|                url|    device|touchproduct|     trans_timestamp|partition_0|partition_1|partition_2|partition_3|\n+------+------------------+-------------------+----------+------------+--------------------+-----------+-----------+-----------+-----------+\n|    44|             Alexa|          beer_cart|app_tablet|         202|2019-10-30T15:00:...|       2019|         10|         30|         15|\n|    59|      facebook.com|   beer_vitrine_nav|   browser|           0|2019-10-30T15:00:...|       2019|         10|         30|         15|\n|    53|    Jao_Cervejeiro|beer_product_detail|app_mobile|          53|2019-10-30T15:00:...|       2019|         10|         30|         15|\n|    56|        amazon.com|beer_product_detail|app_tablet|         129|2019-10-30T15:00:...|       2019|         10|         30|         15|\n|    57|        amazon.com|   beer_vitrine_nav|   browser|           0|2019-10-30T15:00:...|       2019|         10|         30|         15|\n|    58|email_CampanhaBeer|          beer_cart|   browser|          57|2019-10-30T15:00:...|       2019|         10|         30|         15|\n|    56|            google|      beer_checkout|app_tablet|          88|2019-10-30T15:00:...|       2019|         10|         30|         15|\n|    27|        BeerHug_TV|      beer_checkout|   browser|         140|2019-10-30T15:00:...|       2019|         10|         30|         15|\n|    55|             Alexa|beer_product_detail|app_tablet|          58|2019-10-30T15:00:...|       2019|         10|         30|         15|\n|    45|      facebook.com|   beer_vitrine_nav|app_tablet|           0|2019-10-30T15:00:...|       2019|         10|         30|         15|\n+------+------------------+-------------------+----------+------------+--------------------+-----------+-----------+-----------+-----------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1583601193950_-686596934","id":"20181208-134500_546755517","dateCreated":"2020-03-07T17:13:13+0000","dateStarted":"2020-03-07T17:17:42+0000","dateFinished":"2020-03-07T17:22:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2675"},{"title":"Também é possível acessar diretamente o S3 em vez de ler tabelas","text":"%pyspark\n# substitua o <bucket-name> pelo nome do seu bucket. Coloque ano, mes, dia e hora que exista no seu bucket s3. \n# df = spark.read.json(\"s3://<bucket-name>/rawdata/ano/mes/dia/hora/\")\ndf = spark.read.json(\"s3://demo-ecommerce-940067647253/rawdata/2020/03/07/05/\")\ndf.show()","user":"anonymous","dateUpdated":"2020-03-07T17:21:30+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+----------+------------+------------------+--------------------+-------------------+\n|custid|    device|touchproduct|       trafficfrom|     trans_timestamp|                url|\n+------+----------+------------+------------------+--------------------+-------------------+\n|    24|app_mobile|         192|        amazon.com|2020-03-07T05:39:...|beer_product_detail|\n|    27|app_mobile|          22|             Alexa|2020-03-07T05:39:...|      beer_checkout|\n|    33|app_tablet|         172|            google|2020-03-07T05:39:...|beer_product_detail|\n|    42|app_tablet|           0|        amazon.com|2020-03-07T05:39:...|   beer_vitrine_nav|\n|    48|app_mobile|         140|        amazon.com|2020-03-07T05:39:...|          beer_cart|\n|    12|   browser|          37|             Alexa|2020-03-07T05:39:...|          beer_cart|\n|    31|   browser|         127|            google|2020-03-07T05:39:...|beer_product_detail|\n|    55|app_mobile|           0|       twitter.com|2020-03-07T05:39:...|   beer_vitrine_nav|\n|    59|app_tablet|         241|             Alexa|2020-03-07T05:39:...|beer_product_detail|\n|    57|   browser|         127|       twitter.com|2020-03-07T05:39:...|          beer_cart|\n|    35|   browser|          35|             Alexa|2020-03-07T05:39:...|      beer_checkout|\n|    53|app_tablet|           0|        BeerHug_TV|2020-03-07T05:39:...|   beer_vitrine_nav|\n|    21|app_mobile|         143|        amazon.com|2020-03-07T05:39:...|          beer_cart|\n|    48|app_mobile|           0| email_MyFirstBeer|2020-03-07T05:39:...|   beer_vitrine_nav|\n|    35|   browser|           0|             Alexa|2020-03-07T05:39:...|   beer_vitrine_nav|\n|    48|app_mobile|           5|             Alexa|2020-03-07T05:39:...|          beer_cart|\n|    32|   browser|         224|email_CampanhaBeer|2020-03-07T05:39:...|beer_product_detail|\n|    36|app_tablet|           2| email_MyFirstBeer|2020-03-07T05:39:...|beer_product_detail|\n|    54|   browser|         207|            google|2020-03-07T05:39:...|beer_product_detail|\n|    66|   browser|         108| email_MyFirstBeer|2020-03-07T05:39:...|      beer_checkout|\n+------+----------+------------+------------------+--------------------+-------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1583601193951_785986993","id":"20181208-134540_1669931981","dateCreated":"2020-03-07T17:13:13+0000","dateStarted":"2020-03-07T17:21:30+0000","dateFinished":"2020-03-07T17:22:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2676"},{"text":"%pyspark\n# substitua o <bucket-name> pelo nome do seu bucket. Coloque ano, mes, dia e hora que exista no seu bucket s3\n# df = spark.read.csv(\"s3://<bucket-name>/aggregated/ano/mes/dia/hora/\")\ndf2 = spark.read.csv(\"s3://demo-ecommerce-940067647253/rawdata/2020/03/07/05/\")\ndf2.show()","user":"anonymous","dateUpdated":"2020-03-07T17:59:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------------------+--------------------+--------------------+--------------------+--------------------+\n|          _c0|                 _c1|                 _c2|                 _c3|                 _c4|                 _c5|\n+-------------+--------------------+--------------------+--------------------+--------------------+--------------------+\n|{\"custid\": 24| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"app_m...| \"touchproduct\": 192| \"trans_timestamp...|\n|{\"custid\": 27| \"trafficfrom\": \"...| \"url\": \"beer_che...| \"device\": \"app_m...|  \"touchproduct\": 22| \"trans_timestamp...|\n|{\"custid\": 33| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"app_t...| \"touchproduct\": 172| \"trans_timestamp...|\n|{\"custid\": 42| \"trafficfrom\": \"...| \"url\": \"beer_vit...| \"device\": \"app_t...|   \"touchproduct\": 0| \"trans_timestamp...|\n|{\"custid\": 48| \"trafficfrom\": \"...|  \"url\": \"beer_cart\"| \"device\": \"app_m...| \"touchproduct\": 140| \"trans_timestamp...|\n|{\"custid\": 12| \"trafficfrom\": \"...|  \"url\": \"beer_cart\"| \"device\": \"browser\"|  \"touchproduct\": 37| \"trans_timestamp...|\n|{\"custid\": 31| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"browser\"| \"touchproduct\": 127| \"trans_timestamp...|\n|{\"custid\": 55| \"trafficfrom\": \"...| \"url\": \"beer_vit...| \"device\": \"app_m...|   \"touchproduct\": 0| \"trans_timestamp...|\n|{\"custid\": 59| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"app_t...| \"touchproduct\": 241| \"trans_timestamp...|\n|{\"custid\": 57| \"trafficfrom\": \"...|  \"url\": \"beer_cart\"| \"device\": \"browser\"| \"touchproduct\": 127| \"trans_timestamp...|\n|{\"custid\": 35| \"trafficfrom\": \"...| \"url\": \"beer_che...| \"device\": \"browser\"|  \"touchproduct\": 35| \"trans_timestamp...|\n|{\"custid\": 53| \"trafficfrom\": \"...| \"url\": \"beer_vit...| \"device\": \"app_t...|   \"touchproduct\": 0| \"trans_timestamp...|\n|{\"custid\": 21| \"trafficfrom\": \"...|  \"url\": \"beer_cart\"| \"device\": \"app_m...| \"touchproduct\": 143| \"trans_timestamp...|\n|{\"custid\": 48| \"trafficfrom\": \"...| \"url\": \"beer_vit...| \"device\": \"app_m...|   \"touchproduct\": 0| \"trans_timestamp...|\n|{\"custid\": 35| \"trafficfrom\": \"...| \"url\": \"beer_vit...| \"device\": \"browser\"|   \"touchproduct\": 0| \"trans_timestamp...|\n|{\"custid\": 48| \"trafficfrom\": \"...|  \"url\": \"beer_cart\"| \"device\": \"app_m...|   \"touchproduct\": 5| \"trans_timestamp...|\n|{\"custid\": 32| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"browser\"| \"touchproduct\": 224| \"trans_timestamp...|\n|{\"custid\": 36| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"app_t...|   \"touchproduct\": 2| \"trans_timestamp...|\n|{\"custid\": 54| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"browser\"| \"touchproduct\": 207| \"trans_timestamp...|\n|{\"custid\": 66| \"trafficfrom\": \"...| \"url\": \"beer_che...| \"device\": \"browser\"| \"touchproduct\": 108| \"trans_timestamp...|\n+-------------+--------------------+--------------------+--------------------+--------------------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1583601193951_-130418517","id":"20181208-140532_192880319","dateCreated":"2020-03-07T17:13:13+0000","dateStarted":"2020-03-07T17:59:21+0000","dateFinished":"2020-03-07T17:59:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2677"},{"text":"%pyspark\ndf2 = df2.withColumnRenamed(\"_c0\", \"custid\")\ndf2 = df2.withColumnRenamed(\"_c1\", \"trafficfrom\")\ndf2 = df2.withColumnRenamed(\"_c2\", \"url\")\ndf2 = df2.withColumnRenamed(\"_c3\", \"device\")\ndf2 = df2.withColumnRenamed(\"_c4\", \"touchproduct\")\ndf2 = df2.withColumnRenamed(\"_c5\", \"trans_timestamp\")","user":"anonymous","dateUpdated":"2020-03-07T17:59:40+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1583603692753_1913239043","id":"20200307-175452_153724976","dateCreated":"2020-03-07T17:54:52+0000","dateStarted":"2020-03-07T17:59:40+0000","dateFinished":"2020-03-07T17:59:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2678"},{"text":"%pyspark\ndf2.show()","user":"anonymous","dateUpdated":"2020-03-07T17:59:59+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------------------+--------------------+--------------------+--------------------+--------------------+\n|       custid|         trafficfrom|                 url|              device|        touchproduct|     trans_timestamp|\n+-------------+--------------------+--------------------+--------------------+--------------------+--------------------+\n|{\"custid\": 24| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"app_m...| \"touchproduct\": 192| \"trans_timestamp...|\n|{\"custid\": 27| \"trafficfrom\": \"...| \"url\": \"beer_che...| \"device\": \"app_m...|  \"touchproduct\": 22| \"trans_timestamp...|\n|{\"custid\": 33| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"app_t...| \"touchproduct\": 172| \"trans_timestamp...|\n|{\"custid\": 42| \"trafficfrom\": \"...| \"url\": \"beer_vit...| \"device\": \"app_t...|   \"touchproduct\": 0| \"trans_timestamp...|\n|{\"custid\": 48| \"trafficfrom\": \"...|  \"url\": \"beer_cart\"| \"device\": \"app_m...| \"touchproduct\": 140| \"trans_timestamp...|\n|{\"custid\": 12| \"trafficfrom\": \"...|  \"url\": \"beer_cart\"| \"device\": \"browser\"|  \"touchproduct\": 37| \"trans_timestamp...|\n|{\"custid\": 31| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"browser\"| \"touchproduct\": 127| \"trans_timestamp...|\n|{\"custid\": 55| \"trafficfrom\": \"...| \"url\": \"beer_vit...| \"device\": \"app_m...|   \"touchproduct\": 0| \"trans_timestamp...|\n|{\"custid\": 59| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"app_t...| \"touchproduct\": 241| \"trans_timestamp...|\n|{\"custid\": 57| \"trafficfrom\": \"...|  \"url\": \"beer_cart\"| \"device\": \"browser\"| \"touchproduct\": 127| \"trans_timestamp...|\n|{\"custid\": 35| \"trafficfrom\": \"...| \"url\": \"beer_che...| \"device\": \"browser\"|  \"touchproduct\": 35| \"trans_timestamp...|\n|{\"custid\": 53| \"trafficfrom\": \"...| \"url\": \"beer_vit...| \"device\": \"app_t...|   \"touchproduct\": 0| \"trans_timestamp...|\n|{\"custid\": 21| \"trafficfrom\": \"...|  \"url\": \"beer_cart\"| \"device\": \"app_m...| \"touchproduct\": 143| \"trans_timestamp...|\n|{\"custid\": 48| \"trafficfrom\": \"...| \"url\": \"beer_vit...| \"device\": \"app_m...|   \"touchproduct\": 0| \"trans_timestamp...|\n|{\"custid\": 35| \"trafficfrom\": \"...| \"url\": \"beer_vit...| \"device\": \"browser\"|   \"touchproduct\": 0| \"trans_timestamp...|\n|{\"custid\": 48| \"trafficfrom\": \"...|  \"url\": \"beer_cart\"| \"device\": \"app_m...|   \"touchproduct\": 5| \"trans_timestamp...|\n|{\"custid\": 32| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"browser\"| \"touchproduct\": 224| \"trans_timestamp...|\n|{\"custid\": 36| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"app_t...|   \"touchproduct\": 2| \"trans_timestamp...|\n|{\"custid\": 54| \"trafficfrom\": \"...| \"url\": \"beer_pro...| \"device\": \"browser\"| \"touchproduct\": 207| \"trans_timestamp...|\n|{\"custid\": 66| \"trafficfrom\": \"...| \"url\": \"beer_che...| \"device\": \"browser\"| \"touchproduct\": 108| \"trans_timestamp...|\n+-------------+--------------------+--------------------+--------------------+--------------------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1583603833055_717876585","id":"20200307-175713_1155234240","dateCreated":"2020-03-07T17:57:13+0000","dateStarted":"2020-03-07T17:59:59+0000","dateFinished":"2020-03-07T17:59:59+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2679"},{"title":"Gravar o dataframe em formato parquet em um bucket de destino","text":"%pyspark\nDESTINO='s3://hackmaster-bucket/df2'\ndf2.write \\\n    .format(\"parquet\") \\\n    .option(\"compression\", \"snappy\") \\\n    .mode(\"append\") \\\n    .saveAsTable(\"df2\",path=DESTINO) \n","user":"anonymous","dateUpdated":"2020-03-07T18:18:18+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1583601193951_-319185237","id":"20190412-232253_1471290996","dateCreated":"2020-03-07T17:13:13+0000","dateStarted":"2020-03-07T18:18:18+0000","dateFinished":"2020-03-07T18:18:30+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2680"},{"text":"%pyspark\nDESTINO='s3://hackmaster-bucket/df'\ndf.write \\\n    .format(\"parquet\") \\\n    .option(\"compression\", \"snappy\") \\\n    .mode(\"append\") \\\n    .saveAsTable(\"df\",path=DESTINO) ","user":"anonymous","dateUpdated":"2020-03-07T18:30:52+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1583601193951_-1950428985","id":"20190412-232348_380602243","dateCreated":"2020-03-07T17:13:13+0000","dateStarted":"2020-03-07T18:30:52+0000","dateFinished":"2020-03-07T18:31:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2681"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2020-03-07T18:30:52+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1583605852211_-482732011","id":"20200307-183052_427798675","dateCreated":"2020-03-07T18:30:52+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:2682"}],"name":"Hackamasters","id":"2F4ZBFETV","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}